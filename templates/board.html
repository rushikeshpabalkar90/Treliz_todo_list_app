{% include 'header.html' %}
<body>

<div class="background">
    <img src="{{ one_board.board_background_image }}" alt="">
</div>

<div class="navbar-bg-blur">


    <div id="navbar">

        <div class="back-icon mx-lg-3 mx-md-3 mx-sm-2 mx-1">
            <a href="{{ url_for('boards_manager') }}">
                <img src="/static/assets/svg-vector/back-icon.svg" alt="">
            </a>
        </div>
        <div class="mx-lg-3 mx-md-3 mx-sm-2 mx-1 board-favorite-btn">
            <form action="{{ url_for('board', board_id=one_board.board_id) }}" method="post"
                  enctype="multipart/form-data">
                <input type="hidden" name="a">
                {% if one_board.board_favorite %}
                    <button href="" type="submit" role="button" name="favorite_btn">
                        <img class="like-btn-icon" src="/static/assets/svg-vector/like-icon.svg" alt="">
                    </button>
                {% else %}
                    <button href="" type="submit" role="button" name="favorite_btn">
                        <img class="unlike-btn-icon" src="/static/assets/svg-vector/unlike-icon.svg" alt="">
                    </button>
                {% endif %}
            </form>
        </div>
        <div class="board-name me-auto" onclick="showHide('.board-name', '.board-name-edit-form')">
            <div class="nav-title">{{ one_board.board_name }}</div>
            {% if one_board.is_template %}
                <span class="template-text-board">Template</span>
            {% endif %}
        </div>

        <div class="board-name-edit-form hide-toggle">
            <form class="board-name-edit" action="{{ url_for('board', board_id=one_board.board_id) }}" method="post"
                  enctype="multipart/form-data">

                <input required maxlength="11" type="text" name="Board_Name_Edit" class="form-control"
                       value="{{ one_board.board_name }}">

                <button name="board_name_edit_form" type="submit"
                        class="btn btn-primary add-list-form-btn">Save
                </button>

                <a href="#" type="button" onclick="showHide('.board-name', '.board-name-edit-form')"
                   class="close-btn-form-card">
                    <div>
                        <img src="/static/assets/svg-vector/close-button.svg" alt="">
                    </div>
                </a>
            </form>
        </div>


        <div class="filter-btn mx-lg-3 mx-md-2 mx-sm-2 mx-1">
            <a href="#"><img class="filter-icon" src="/static/assets/svg-vector/filter.svg" alt="filter-icon">Filter</a>
        </div>
        <div class="change-bg-btn mx-lg-3 mx-md-2 mx-sm-1 mx-1">
            <a type="button" href="#" data-bs-toggle="offcanvas" data-bs-target="#change-bg"
               aria-controls="offcanvasRight">
                <img class="change-bg-icon" src="/static/assets/svg-vector/change-background.svg"
                     alt="change-background-icon">Background</a>
        </div>
    </div>

</div>


<section id="board-main-page">

    <ol id="board-row">

        {% for list in all_lists %}
            {% if list.parent_board_id == one_board.board_id %}
                <li>
                    <div class="list-container">
                        <div id="idListBtn{{ list.list_id }}">
                            <div class="list-heading hide-toggle">
                                <div class="list-name">
                                    <div class="list-name-title"
                                         onclick="showHideListForm('#idListBtn{{ list.list_id }}',
                                                 '#idListForm{{ list.list_id }}')">
                                        {{ list.list_name }}
                                    </div>

                                </div>

                                <div class="dropdown-menu-end">
                                    <a data-bs-auto-close="outside" role="button" class="menu-icon-link"
                                       data-bs-toggle="dropdown"
                                       aria-expanded="false">
                                        <img class="menu-icon" src="/static/assets/svg-vector/menu.svg" alt="">
                                    </a>
                                    <div class="dropdown-menu list-menubar">
                                        <h5 class="list-menubar-header">List actions</h5>
                                        <hr>
                                        <ul>
                                            <li>
                                                <button class="btn btn-light" href="#"
                                                        onclick="showHide('.add-card-toggle', '.add-card-form')"
                                                        data-bs-dismiss="modal">Add card
                                                </button>
                                            </li>
                                            <li>
                                                <div class="dropend">
                                                    <button class="btn btn-light" href="#" data-bs-toggle="dropdown"
                                                            aria-expanded="false">Move list
                                                    </button>
                                                    <div class="dropdown-menu" style="background: transparent;">
                                                        <div class="list-dropdown-submenu">
                                                            <h5 class="move-list-header">Move list</h5>
                                                            <hr>
                                                            <form action="{{ url_for('board', board_id=one_board.board_id) }}"
                                                                  method="post" enctype="multipart/form-data">
                                                                <div class="mb-3">
                                                                    <label for="">Select destination</label>
                                                                </div>
                                                                <div class="mb-3">
                                                                    <label for="boardMoveListSelect"
                                                                           class="form-label">Board</label>
                                                                    <select id="boardMoveListSelect"
                                                                            onchange="changeListOptions(this, {{ list.list_position }}, {{ list.list_id }})"
                                                                            name="Dest_Board_Move_List"
                                                                            class="form-select board-select"
                                                                            aria-label="Default select example">
                                                                        <option selected
                                                                                value="{{ one_board.board_id }}">
                                                                            {{ one_board.board_name }} (current)
                                                                        </option>
                                                                        {% for board in all_boards %}
                                                                            {% if board != one_board %}
                                                                                <option value="{{ board.board_id }}">
                                                                                    {{ board.board_name }}</option>
                                                                            {% endif %}
                                                                        {% endfor %}
                                                                    </select>
                                                                </div>

                                                                <div class="mb-3">
                                                                    <label for="listPositionSelect"
                                                                           class="form-label">Position</label>
                                                                    <input type="hidden" name="Current_List_Position"
                                                                           value="{{ list.list_position }}">
                                                                    <select id="listPositionSelect{{ list.list_id }}"
                                                                            class="form-select"
                                                                            aria-label="Default select example"
                                                                            name="Dest_Position_Move_List">
                                                                        {% for list_ in all_lists %}
                                                                            {% if list_.parent_board_id == one_board.board_id %}
                                                                                {% if list_ == list %}
                                                                                    <option selected
                                                                                            value="{{ list_.list_position }}">
                                                                                        {{ list_.list_position }}
                                                                                        (current)
                                                                                    </option>
                                                                                {% else %}
                                                                                    <option value="{{ list_.list_position }}">
                                                                                        {{ list_.list_position }}</option>
                                                                                {% endif %}
                                                                            {% endif %}
                                                                        {% endfor %}
                                                                    </select>
                                                                </div>
                                                                <div class="mb-3">
                                                                    <button data-bs-dismiss="modal"
                                                                            name="move_list_form"
                                                                            class="btn btn-primary move-list-btn"
                                                                            type="submit">Move
                                                                    </button>
                                                                </div>
                                                            </form>

                                                        </div>
                                                    </div>
                                                </div>
                                            </li>
                                            <li>
                                                <div class="dropend">
                                                    <button class="btn btn-light" href="#" data-bs-toggle="dropdown"
                                                            aria-expanded="false">Copy list
                                                    </button>
                                                    <div class="dropdown-menu" style="background: transparent;">
                                                        <div class="list-dropdown-submenu">
                                                            <h5 class="move-list-header">Copy list</h5>
                                                            <hr>
                                                            <form action="{{ url_for('board', board_id=one_board.board_id) }}"
                                                                  method="post" enctype="multipart/form-data">
                                                                <div class="mb-3">
                                                                    <label for="">Name</label>
                                                                </div>
                                                                <div class="mb-3">
                                                                    <input type="hidden" name="Current_List_Id"
                                                                           value="{{ list.list_id }}">
                                                                    <input type="hidden" name="Current_List_Position"
                                                                           value="{{ list.list_position }}">
                                                                    <input required maxlength="30" type="text"
                                                                           class="form-control" name="List_Name_Copy"
                                                                           value="{{ list.list_name }}">
                                                                </div>
                                                                <div class="mb-3">
                                                                    <button data-bs-dismiss="modal"
                                                                            name="copy_list_form"
                                                                            class="btn btn-primary move-list-btn"
                                                                            type="submit">Copy list
                                                                    </button>
                                                                </div>
                                                            </form>

                                                        </div>
                                                    </div>
                                                </div>
                                            </li>
                                            <li>
                                                <div class="dropend">
                                                    <button class="btn btn-light" href="#" data-bs-toggle="dropdown"
                                                            aria-expanded="false">Delete list
                                                    </button>
                                                    <div class="dropdown-menu" style="background: transparent;">
                                                        <div class="list-dropdown-submenu">
                                                            <h5 class="move-list-header">Delete list</h5>
                                                            <hr>
                                                            <form action="{{ url_for('board', board_id=one_board.board_id) }}"
                                                                  method="post" enctype="multipart/form-data">
                                                                <input type="hidden" name="Current_List_Id"
                                                                       value="{{ list.list_id }}">
                                                                <div class="mb-3">
                                                                    <label for="">Deleting a list is permanent. There is
                                                                        no undo.</label>
                                                                </div>

                                                                <div class="mb-3">
                                                                    <button name="delete_list_form"
                                                                            class="btn btn-danger move-list-btn"
                                                                            type="submit">Delete
                                                                    </button>
                                                                </div>
                                                            </form>

                                                        </div>
                                                    </div>
                                                </div>
                                            </li>
                                        </ul>
                                    </div>
                                </div>

                            </div>
                        </div>

                        <form class="list-name-edit-form hide-toggle" id="idListForm{{ list.list_id }}" method="post"
                              action="{{ url_for('board', board_id=one_board.board_id) }}"
                              enctype="multipart/form-data">

                            <div class="mb-3">
                                <input type="text" name="List_Name_Edit" class="form-control"
                                       value="{{ list.list_name }}">
                            </div>
                            <input type="hidden" name="List_Id" value="{{ list.list_id }}">
                            <button name="list_name_edit_form" type="submit" class="btn btn-primary">save</button>
                            <button type="button" class="btn btn-primary" name="edit_list"
                                    onclick="showHideListForm('#idListBtn{{ list.list_id }}',
                                            '#idListForm{{ list.list_id }}')">cancel
                            </button>
                        </form>


                        <ol id="all-cards">
                            {% for card in all_cards %}
                                {% if card.parent_list_id == list.list_id %}
                                    <li>
                                        <a href="{{ url_for('card', id_=one_board.board_id, card_id=card.card_id) }}"
                                           role="button"
                                           aria-controls="edit-card">
                                            <div class="shadow-sm bg-white card">
                                                <img class="cover-img" src="{{ card.card_cover }}" alt="">
                                                <div class="card-body">
                                                    <p class="card-title">{{ card.card_name }}</p>
                                                    <div class="card-text">
                                                        {% if card.card_dueDate %}
                                                            <div><img src="/static/assets/svg-vector/clock.svg"
                                                                      alt="">{{ card.card_dueDate.strftime('%b %d') }}
                                                            </div>
                                                        {% endif %}
                                                        {% if card.card_description %}
                                                            <div data-bs-container="body" data-bs-toggle="tooltip"
                                                                 data-bs-placement="bottom"
                                                                 title='{{ card.card_description| striptags }}'>
                                                                <img src="/static/assets/svg-vector/description.svg"
                                                                     alt="">
                                                            </div>
                                                        {% endif %}

                                                        {% set count = namespace(value=0) %}

                                                        {% for attachment in all_attachments %}
                                                            {% if attachment.parent_card_id == card.card_id %}
                                                                {% set count.value = count.value + 1 %}
                                                            {% endif %}
                                                        {% endfor %}
                                                        {% if count.value > 0 %}
                                                            <div>
                                                                <img src="/static/assets/svg-vector/attachment.svg"
                                                                     alt="">{{ count.value }}
                                                            </div>
                                                        {% endif %}

                                                        {% if all_checklistItems %}
                                                            <div>
                                                                <img src="/static/assets/svg-vector/checkbox.svg"
                                                                     alt="">1/3
                                                            </div>
                                                        {% endif %}
                                                    </div>
                                                </div>
                                            </div>
                                        </a>
                                    </li>
                                {% endif %}
                            {% endfor %}

                            <li>
                                <div class="add-card-form hide-toggle" id="idCardForm{{ list.list_id }}">
                                    <form class="signup-form"
                                          action="{{ url_for('board', board_id=one_board.board_id) }}"
                                          method="post" enctype="multipart/form-data">
                                        <label class="add-card-form-input">
                                        <textarea name="Card_Name" style="resize: none;" class="form-control"
                                                  placeholder="Enter a name for this card..." rows="2"
                                                  required maxlength="20"></textarea>
                                        </label>
                                        <input type="hidden" name="List_Id" value="{{ list.list_id }}">
                                        <button type="submit" name="add_card" class="btn btn-primary add-card-form-btn">
                                            Add card
                                        </button>
                                        <a href="#" type="button" class="close-btn-form-card"
                                           onclick="showHideListForm('#idCardBtn{{ list.list_id }}',
                                                   '#idCardForm{{ list.list_id }}')">
                                            <div><img src="/static/assets/svg-vector/close-button.svg" alt=""></div>
                                        </a>
                                    </form>
                                </div>
                            </li>
                        </ol>


                        {# Add a Card btn #}
                        <a onclick="showHideListForm('#idCardBtn{{ list.list_id }}', '#idCardForm{{ list.list_id }}')"
                           class="add-card-toggle" id="idCardBtn{{ list.list_id }}">
                            <div class="add-card-btn">
                                <img class="plus-sign-icon" src="/static/assets/svg-vector/plus-sign-black.svg" alt="">
                                Add a card
                                <img class="card-icon " src="/static/assets/svg-vector/card-icon.svg" alt="">
                            </div>
                        </a>
                    </div>
                </li>
            {% endif %}
        {% endfor %}

        <li>
            <a href="#" onclick="showHide('.add-btn-toggle', '.add-list-form')" class="add-btn-toggle">
                <div class="add-btn">
                    <img class="plus-sign-icon" src="/static/assets/svg-vector/plus-sign-black.svg" alt=""> Add a list
                </div>
            </a>
        </li>

        <li>
            <div class="add-list-form hide-toggle">

                <form class="signup-form" action="{{ url_for('board', board_id=one_board.board_id) }}" method="post"
                      enctype="multipart/form-data">
                    <label>
                        <input required maxlength="30" name="List_Name" type="text" class="form-control add-list-input"
                               placeholder="Enter list name...">
                    </label>
                    <button name="add_list" type="submit"
                            class="btn btn-primary add-list-form-btn">Add list
                    </button>

                    <a href="#" type="button" onclick="showHide('.add-btn-toggle', '.add-list-form')"
                       class="close-btn-form-card">
                        <div>
                            <img src="/static/assets/svg-vector/close-button.svg" alt="">
                        </div>
                    </a>
                </form>
            </div>
        </li>
    </ol>
</section>


{# Change Background offcanvas #}

<div class="offcanvas offcanvas-end change-bg-panel" id="change-bg" data-bs-keyboard="false" tabindex="-1"
     aria-labelledby="offcanvasRight">
    <div class="offcanvas-header">
        <h5 class="cng-bg-title" id="offcanvasRightLabel">Change Background</h5>
        <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">
        <ul class="nav nav-pills mb-3 change-bg-tabs" id="pills-tab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="pills-home-tab" data-bs-toggle="pill"
                        data-bs-target="#pills-home"
                        type="button" role="tab" aria-controls="pills-home" aria-selected="true">Colors
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="pills-profile-tab" data-bs-toggle="pill"
                        data-bs-target="#pills-profile"
                        type="button" role="tab" aria-controls="pills-profile" aria-selected="false">Photos
                </button>
            </li>
        </ul>
        <form action="{{ url_for('board', board_id=one_board.board_id) }}" method="post"
              enctype="multipart/form-data">

            <div class="tab-content" id="pills-tabContent">

                <div class="tab-pane fade show active" id="pills-home" role="tabpanel"
                     aria-labelledby="pills-home-tab">

                    <div class="flex-color-parent">
                        {% for bg_color in all_colors %}
                            <input type="radio" class="board-bg-color-modal"
                                   name="boardBgOption"
                                   id="colorRadioModal{{ all_colors.index(bg_color) }}"
                                   value="/static/assets/images/board_background_img/bg_colors/{{ bg_color }}">
                            <label class="display-selector"
                                   for="colorRadioModal{{ all_colors.index(bg_color) }}"
                                   style="background-image: url('/static/assets/images/board_background_img/bg_colors/{{ bg_color }}');"></label>

                        {% endfor %}

                    </div>


                </div>

                <div class="tab-pane fade" id="pills-profile" role="tabpanel"
                     aria-labelledby="pills-profile-tab">

                    <div class="flex-img-parent">
                        {% for bg_img in all_images %}
                            <input type="radio" class="board-bg-img-modal" name="boardBgOption"
                                   id="imgRadioModal{{ all_images.index(bg_img) }}"
                                   value="{{ bg_img }}">
                            <label class="display-selector" for="imgRadioModal{{ all_images.index(bg_img) }}"
                                   style="background-image: url('{{ bg_img }}');"></label>
                        {% endfor %}
                    </div>
                </div>
                <button type="submit" class="btn btn-primary change-btn mb-3" data-bs-dismiss="modal"
                        name="change_board_bg">Change
                </button>
            </div>
        </form>
    </div>
</div>


<script>
    let unlikeBtn = document.querySelector('.unlike-btn-icon');
    let likeBtn = document.querySelector('.like-btn-icon');
</script>

<script>
    let displaySelectors = document.getElementsByClassName('display-selector');
    {#let displayDivModal = document.getElementById('board-bg-display-modal')#}
    {#let displayDiv = document.getElementById('board-bg-display');#}
    {#let displaySelectors = #}

    for (let i = 0; i < displaySelectors.length; i++) {
        displaySelectors[i].addEventListener('click', function () {
            {#let selectorSRC = displaySelectors[i].style.backgroundImage.slice(4, -1).replace(/"/g, "")#}
            for (let j = 0; j < displaySelectors.length; j++) {
                displaySelectors[j].style.border = "1px solid white";
                displaySelectors[j].style.boxShadow = 'none';
            }
            displaySelectors[i].style.border = "2px solid #86b7fe";
            displaySelectors[i].style.boxShadow = "0 0 0 .25rem rgba(13, 110, 253, .25)";
        });
    }
</script>
<script>

    function changeListOptions(chooser, listPosition, listId) {
        let selectedOption = (chooser.options[chooser.selectedIndex].value);

        {# empty options form child #}
        let listOptions = document.getElementById('listPositionSelect' + listId)
        {#let listOptionsList = document.getElementsByClassName('listPositionSelect');#}
        {#for (let listOptions of listOptionsList) {#}
        listOptions.options.length = 0;

        {#check for selectedBoardId is equal to list.parent_board_id#}
        {# check if selected is current board if yes check for if listPosition is equal to #}
        {% for list in all_lists %}
            if (selectedOption == {{ list.parent_board_id }}) {
                if (selectedOption == {{ one_board.board_id }}) {
                    if ({{ list.list_position }} == listPosition) {
                        listOptions.options[listOptions.options.length] =
                            new Option({{ list.list_position }} + '(current)', {{ list.list_position }}, true, true);
                    } else {
                        listOptions.options[listOptions.options.length] =
                            new Option({{ list.list_position }}, {{ list.list_position }});
                    }
                } else {
                    listOptions.options[listOptions.options.length] =
                        new Option({{ list.list_position }}, {{ list.list_position }});
                }
            }


        {% endfor %}

    }

    function showHide(a, b) {
        let btn = document.querySelector(a);
        let div = document.querySelector(b);
        btn.classList.toggle('hide-toggle');
        div.classList.toggle('hide-toggle');
    }

    function showHideListForm(a, b) {
        let addBtn = document.querySelector(a);
        let addForm = document.querySelector(b);

        addBtn.classList.toggle('hide-toggle');
        addForm.classList.toggle('hide-toggle');
    }

    function popupMenu(c) {
        let PopupDiv = document.querySelector(c);
        PopupDiv.classList.toggle('hide-toggle');
    }

</script>

<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"
        integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB"
        crossorigin="anonymous">

</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js"
        integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13"
        crossorigin="anonymous">

</script>

</body>
